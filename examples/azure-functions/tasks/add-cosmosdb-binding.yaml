# Add Cosmos DB Binding
id: add-cosmosdb-binding-001
name: Add Cosmos DB Binding
description: Test adding a Cosmos DB input/output binding to an existing function

inputs:
  prompt: "Add a Cosmos DB output binding to my Azure Function to store processed data"
  context:
    project_type: "azure-functions"
    language: "python"
    has_existing_function: true
  files:
    - path: function_app.py
      content: |
        import azure.functions as func
        app = func.FunctionApp()

        @app.route(route="process")
        def process_data(req: func.HttpRequest) -> func.HttpResponse:
            data = req.get_json()
            # TODO: Store to Cosmos DB
            return func.HttpResponse("Processed")

expected:
  outcomes:
    - type: binding_added
    - type: configuration_updated

  output_contains:
    - "cosmos"

  tool_calls:
    required:
      - pattern: "cosmos|binding"
    forbidden:
      - pattern: "rm -rf"

  behavior:
    max_tool_calls: 15
    max_iterations: 5

graders:
  - name: cosmos_binding_added
    type: code
    assertions:
      - "'cosmos' in output.lower()"

  - name: output_binding_syntax
    type: regex
    config:
      pattern: "cosmos_db_output|CosmosDBOutput|@app\\.cosmos|output.*cosmos"
      should_match: true
